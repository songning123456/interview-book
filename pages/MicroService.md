#### 调用Dubbo的时候如何处理请求超时的情况？
Dubbo在调用服务不成功时，默认是会重试两次的。这样在服务端的处理时间超过了设定的超时时间时，就会有重复请求，比如在发邮件时，可能就会发出多份重复邮件，执行注册请求时，就会插入多条重复的注册数据，那么怎么解决超时问题呢？


<span style="color: red">对于核心的服务中心，去除Dubbo超时重试机制，并重新评估设置超时时间。</span>


<span style="color: red">业务处理代码必须放在服务端，客户端只做参数验证和服务调用，不涉及业务流程处理。</span>


```
<!-- 延迟到Spring初始化完成后，再暴露服务,服务调用超时设置为6秒,超时不重试-->  
<dubbo:provider delay="-1" timeout="6000" retries="0"/>
```


当然Dubbo的重试机制其实是非常好的QOS保证，它的路由机制，是会帮你把超时的请求路由到其他机器上，而不是本机尝试，所以dubbo的重试机器也能一定程度的保证服务的质量。但是请一定要综合线上的访问情况，给出综合的评估。


#### Zookeeper挂掉了Dubbo还能继续使用吗？
* 监控中心宕掉不影响使用，只是丢失部分采样数据。


* 数据库宕掉后，注册中心仍能通过缓存提供服务列表查询，但不能注册新服务。


* 注册中心对等集群，任意一台宕掉后，将自动切换到另一台。


* 注册中心全部宕掉后，服务提供者和服务消费者仍能通过本地缓存通讯。


* 服务提供者无状态，任意一台宕掉后，不影响使用。


* 服务提供者全部宕掉后，服务消费者应用将无法使用，并无限次重连等待服务提供者恢复。


#### 你们的系统使用了哪种服务框架？为什么要这样技术选型？
| ———— | Spring Cloud | Dubbo | 
| :----- | :----- | :----- | 
| 并发性能 | 使用的是HTTP协议，性能与Dubbo对比稍微差点 | 是一款优秀的RPC框架，并发能力比Spring Cloud强 | 
| 注册中心 | 有全家桶配置中心: eureka nacos，亦可以选择Zookeeper | 一般选择Zookeeper | 
| 分布式配置中心 | nacos / Spring Cloud Config | 阿波罗 | 
| 网关 | Zuul / Spring Cloud Gateway  | 需引入其他网关组件 | 
| 负载均衡 | ribbon | 自带负载均衡 | 
| 熔断功能 | hystrix | 需引入其他熔断框架 | 
| 社区活跃度 | 活跃，版本更新快 | 不活跃 | 


#### <a href="https://www.cnblogs.com/lgg20/p/12531170.html">看过Dubbo源码吗？说说Dubbo的底层架构原理？</a>
![Dubbo](/images/MicroService/Dubbo.png)


#### 如果让你设计一个RPC框架，该从哪些方向考虑？
| 要点 | 解释 | 
| :----- | :----- | 
| <div style="width: 150px">服务发现与服务注册</div> | 1.如果我们想在Service A中调用Service B，那么我们首先得知道Service B的地址。所以，我们需要有一个服务注册中心，通过这个中心，服务可以把自己的信息注册进来，也可以获取到别的服务的信息；<br> 2.客户端也需要watch服务注册中心的目标服务的地址的变化 | 
| <div style="width: 150px">网络通信</div> | 1.服务和服务之间的网络通信模型， NIO/IO等等；<br> 2.客户端如何复用与服务端的连接， 而不是每次请求都重新创建一个新连接；<br> 3.客户端收到返回后，如何知道是哪个请求的返回并且做出正确处理 | 
| <div style="width: 150px">消息的序列化</div> | 服务间通信的消息通过什么方式进行序列化？Hessian，XML、JSON、Protobuf…，甚至Java原生的序列化方式，你总得选择一个 | 
| <div style="width: 150px">负载均衡</div> | 客户端通过服务注册中心拿到一堆地址，该调哪个呢？最简单的方式，可以通过RR、WRR的方式去做LB | 
| <div style="width: 150px">容灾</div> | 1.健康监测：在某一个服务节点挂掉的时候， 如何在服务注册中心删去这个服务地址？<br> 2.服务调用超时与重试：在调用一个服务实例的时候，如果超时或者报错，怎么处理？<br> 3.服务限流：如何限制最大并发数？这个又可以从客户端和服务端两个角度分析<br> | 


#### 能画一张图说说Spring Cloud的核心架构吗？它又是如何调用的？
![SpringCloud](/images/MicroService/SpringCloud.jpg)


* 首先每个服务启动的时候都需要往注册中心进行注册。


* 用户先对网关发起下单请求，网关收到请求后发现呃，是下单操作，要到订单系统，然后把请求路由到订单系统。


* 订单系统啪啦啪啦一顿操作，然后通过Feign去调用库存系统减库存，通知仓储服务发货，调用积分系统加积分。


* 在发起调用之前，订单系统还得通过Ribbon去注册中心去拉取各系统的注册表信息，并且挑一台机器给Feign来发起网络调用。


#### 你们的服务注册中心进行过选型调研吗？对比一Eureka和Zookeeper？
Zookeeper基于CP，不保证高可用，如果Zookeeper正在选主，或者Zookeeper集群中半数以上机器不可用，那么将无法获得数据。Eureka基于AP，能保证高可用，即使所有机器都挂了，也能拿到本地缓存的数据。作为注册中心，其实配置是不经常变动的，只有发版和机器出故障时会变。对于不经常变动的配置来说，CP是不合适的，而AP在遇到问题时可以用牺牲一致性来保证可用性，既返回旧数据，缓存数据。所以理论上Eureka是更适合作注册中心。而现实环境中大部分项目可能会使用Zookeeper，那是因为集群不够大，并且基本不会遇到用做注册中心的机器一半以上都挂了的情况。所以实际上也没什么大问题。
    


    
